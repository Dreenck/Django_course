{% extends 'basic.html' %}
{% load static %}

{% block css_files %}
  <link rel="stylesheet" href="{% static 'blog/post_detail.css' %}" />
{% endblock %}

{% block title_name %}
  {{ post_detail.title }}
{% endblock %}

{% block content %}
  {% if comment_form.errors %}
    <div id="alert">
      <h2>Saving the comment failed!</h2>
      <p>Please check the comment form below the post and fix your errors!</p>
      <a href="#comment-form">Fix!</a>
    </div>
  {% endif %}

  <section id="summary">
    <h2>{{ post_detail.title }}</h2>
    <div>
      {% for tag in post_tags %}
        <span class="tag">{{ tag.caption }}</span>
      {% endfor %}
    </div>

    <div id="read-later">
      <form action="{% url 'read-later' %}" method="post">
        {% csrf_token %}
        <input type="hidden" value="{{ post_detail.id }}" name="post_id" />
        <button>
          {% if saved_for_later %}
            Remove from "Read Later"
          {% else %}
            Read Later
          {% endif %}
        </button>
      </form>
    </div>

    <article>
      <img src=" {{ post_detail.image.url }} " alt="{{ post_detail.title }}" />
      <address>
        <a href="mailto: {{ post_detail.author.email_address }}">By {{ post_detail.author }}</a>
      </address>
      <div>
        Last updated on <time>{{ post_detail.date|date:'d M Y' }}</time>
      </div>
    </article>
  </section>

  <main>{{ post_detail.content|linebreaks }}</main>

  <section id="comments">
    <ul>
      {% for comment in comments %}
        <li>
          <h2>{{ comment.user_name }}</h2>
          <p>{{ comment.comment_text|linebreaks }}</p>
        </li>
      {% endfor %}
    </ul>
  </section>

  <section id="comment-form">
    <h2>Your Comment</h2>
    <form action="{% url 'post-detail-page' post_detail.slug %}" method="post">
      {% csrf_token %}
      {% for field in comment_form %}
        <div class="form-control {% if field.errors %}invalid{% endif %}">{{ field.label_tag }}
          {{ field }}
          {{ field.errors }}</div>
      {% endfor %}

      <button>Submit</button>
    </form>
  </section>
{% endblock %}
